<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PopupMapper">
	
	<!-- 조회 (non paging) -->
	<select id="selectPopupDataNonPagingList" resultType="map">
		SELECT POPUP_ID
			 , MENU_CD
			 , TITLE
			 , WIDTH
			 , HEIGHT
			 , XGPS
			 , YGPS
			 , CONTENTS
			 , convert(varchar, STARTDAY,120) AS STARTDAY
			 , convert(varchar, ENDDAY,120) AS ENDDAY
			 , USEYN
			 , REG_ID
			 , UDT_ID
			 , convert(varchar, REG_DT,120) AS REG_DT
			 , convert(varchar, UDT_DT,120) AS UDT_DT
			 , INNER_POPUP
		  FROM TB_POPUP
		 WHERE 1=1
		 <if test="title != null and !title.equals('')">
           AND LOWER(TITLE) LIKE LOWER('%' + #{title} + '%')
         </if>
         <if test="POPUP_ID != null and !POPUP_ID.equals('')">
           AND POPUP_ID = #{POPUP_ID}
         </if>
         ORDER BY REG_DT DESC
	</select>
	
	<!-- 삭제 -->
	<delete id="deletePopupData" parameterType="map">
	    DELETE FROM TB_POPUP
	     WHERE POPUP_ID = #{POPUP_ID}
	</delete>
	
	<!-- 수정 -->
	<update id="updatePopupData" parameterType="map">
	    UPDATE TB_POPUP
	       SET TITLE = #{TITLE, jdbcType=VARCHAR}
	         , WIDTH = ISNULL(#{WIDTH, jdbcType=VARCHAR}, 0)
	         , HEIGHT = ISNULL(#{HEIGHT, jdbcType=VARCHAR}, 0)
	         , XGPS = ISNULL(#{XGPS, jdbcType=VARCHAR}, 0)
	         , YGPS = ISNULL(#{YGPS, jdbcType=VARCHAR}, 0)
	         , STARTDAY = #{STARTDAY, jdbcType=VARCHAR}
	         , ENDDAY = #{ENDDAY, jdbcType=VARCHAR}
	         , UDT_ID = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = getDate()
	         , USEYN = ISNULL(#{USEYN, jdbcType=VARCHAR}, 0)
	     WHERE POPUP_ID = #{POPUP_ID} 
	</update>
	
	<update id="updatePopupContents" parameterType="map">
	    UPDATE TB_POPUP
	       SET CONTENTS = #{CONTENTS, jdbcType=VARCHAR}
	         , UDT_ID = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = getDate()
	     WHERE POPUP_ID = #{POPUP_ID} 
	</update>
	
	<!-- 신규 -->
	<insert id="insertPopupData" parameterType="map">
	    INSERT INTO TB_POPUP (
	    	MENU_CD,
	    	TITLE,
	    	WIDTH,
	    	HEIGHT,
	    	XGPS,
	    	YGPS,
	    	CONTENTS,
	    	STARTDAY,
	    	ENDDAY,
	    	USEYN,
	    	REG_ID,
	    	UDT_ID,
	    	UDT_DT,
	    	REG_DT,
	    	INNER_POPUP
	    )VALUES(
	    	   'M01'
			 , #{TITLE, jdbcType=VARCHAR}
			 , ISNULL(#{WIDTH, jdbcType=VARCHAR}, 0)
			 , ISNULL(#{HEIGHT, jdbcType=VARCHAR}, 0)
			 , ISNULL(#{XGPS, jdbcType=VARCHAR}, 0)
			 , ISNULL(#{YGPS, jdbcType=VARCHAR}, 0)
			 , #{CONTENTS, jdbcType=VARCHAR}
			 , #{STARTDAY, jdbcType=VARCHAR}
			 , #{ENDDAY, jdbcType=VARCHAR}
			 , ISNULL(#{USEYN, jdbcType=VARCHAR}, 0)
			 , #{session.userId, jdbcType=VARCHAR}
			 , ''
			 , ''
			 , getDate()
			 , #{INNER_POPUP, jdbcType=VARCHAR}
	    )
	</insert>
	
	<select id="selectPopupFileCnt" resultType="map">
	    SELECT COUNT(*) AS CNT
	      FROM TB_FILE
	     WHERE TBL_PK = #{TBL_PK}
	       AND TBL_NM = 'TB_POPUP'
	</select>
	
	<insert id="insertPopupFileList" parameterType="map">
	    INSERT INTO TB_FILE (
	    	FILE_NM,
	    	SVR_FILE_NM,
	    	FILE_SIZE,
	    	TBL_NM,
	    	TBL_PK,
	    	REG_ID,
	    	UDT_ID,
	    	REG_DT,
	    	UDT_DT,
	    	DOWN_CNT
	    )VALUES(
	    	  #{FILE_NM}
	    	, #{SVR_FILE_NM}
	    	, #{FILE_SIZE}
	    	, 'TB_POPUP'
	    	, #{TBL_PK}
	    	, #{session.userId, jdbcType=VARCHAR}
	    	, ''
	    	, getDate()
	    	, ''
	    	, 0
	    )
	</insert>
	<!-- (SELECT ISNULL(MAX(FILE_SEQ), 0)+1 FROM TB_FILE WHERE TBL_NM = 'TB_POPUP' AND TBL_PK = #{TBL_PK}) -->
	
	<update id="updatePopupFileList" parameterType="map">
	    UPDATE TB_FILE
	       SET FILE_NM = #{FILE_NM}
	         , SVR_FILE_NM = #{SVR_FILE_NM}
	         , FILE_SIZE = #{FILE_SIZE}
	         , UDT_Id = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = getDate()
	     WHERE TBL_NM = 'TB_POPUP'
	       AND TBL_PK = #{TBL_PK}
	       AND FILE_SEQ = #{FILE_SEQ}
	</update>
	
	<select id="selectFileSeqlist" resultType="map">
	    SELECT FILE_SEQ
	      FROM TB_FILE
	     WHERE TBL_NM = 'TB_POPUP'
	       AND TBL_PK = #{TBL_PK}
	</select>
	
</mapper>