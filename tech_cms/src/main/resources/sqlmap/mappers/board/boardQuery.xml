<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardMapper">
	
	<!-- 베너 정보 조회 -->
	<select id="selectBoardDataList" resultType="map">
	    SELECT BOARD_CD
         	  , BOARD_SEQ
         	  , REG_NM
         	  , TITLE
         	  , REG_EMAIL
         	  , CONTENTS
         	  , VW_CNT
         	  , PW
         	  , HTML
         	  , REG_IP
         	  , SUBSCRIPTION_YN
         	  , STATE
         	  , SUMMARY
         	  , SEND_DT
         	  , NOTICE_YN
         	  , SEND_YN
         	  , REG_ID
         	  , REG_DT
         	  , (SELECT TOP 1 MENU_CD FROM TB_MENU_20190909 WHERE BOARD_CD = BD.BOARD_CD) AS MENU_CD
           FROM TB_BOARD BD 
          WHERE '*' = '*'
          <if test="boardCd != null and !boardCd.equals('')">
            AND BOARD_CD = #{boardCd}
       	  </if>
       	  <if test="regStrDt != null and !regStrDt.equals('')">
            AND Convert(varchar(10),REG_DT,112) >= #{regStrDt}
       	  </if>
          <if test="regEndDt != null and !regEndDt.equals('')">
            AND #{regEndDt} >= Convert(varchar(10),REG_DT,112) 
          </if>
          <if test="title != null and !title.equals('')">
            AND LOWER(TITLE) LIKE LOWER('%' + #{title} + '%')
       	  </if>
          ORDER BY REG_DT DESC, BOARD_CD DESC
	</select>
	
	<!-- 베너 정보 조회 -->
	<select id="selectBoardDetailDataList" resultType="map">
	    SELECT BOARD_CD
         	  , BOARD_SEQ
         	  , REG_NM
         	  , TITLE
         	  , REG_EMAIL
         	  , CONTENTS
         	  , VW_CNT
         	  , PW
         	  , HTML
         	  , REG_IP
         	  , SUBSCRIPTION_YN
         	  , STATE
         	  , SUMMARY
         	  , SEND_DT
         	  , NOTICE_YN
         	  , SEND_YN
         	  , REG_ID
         	  , REG_DT
         	  , LANG
         	  , (SELECT TOP 1 MENU_CD FROM TB_MENU_20190909 WHERE BOARD_CD = BD.BOARD_CD) AS MENU_CD
         	  , (SELECT TOP 1 SVR_FILE_NM FROM TB_FILE WHERE TBL_NM='TB_BOARD' AND TBL_PK = BOARD_SEQ) AS FILE_NM 
           FROM TB_BOARD BD 
          WHERE '*' = '*'
            AND BOARD_SEQ = #{SEQ}          
	</select>
	
	<!-- 게시물 종류 데이터 조회 -->
	<select id="selectBoardComboDataList" resultType="map">
		SELECT DISTINCT BOARD_CD AS COM_CD, BOARD_CD AS COM_NM FROM TB_BOARD_AUTH
	</select>
	
	<!-- 게시물 종류 데이터 조회 -->
	<select id="selectBoardFileDataList" resultType="map">
		SELECT FILE_SEQ, SVR_FILE_NM, FILE_NM FROM TB_FILE WHERE TBL_NM='TB_BOARD' AND TBL_PK = #{SEQ}
	</select>
	
	<!-- 게시물 삭제 -->
	<delete id="deleteBoardDataList" parameterType="map">
	    DELETE FROM TB_BOARD
	     WHERE BOARD_CD = #{BOARD_CD}
	       AND BOARD_SEQ = #{BOARD_SEQ}
	</delete>
	
	<!-- 게시물 수정 -->
	<update id="updateBoardDataList" parameterType="map">
	    UPDATE TB_BOARD
	       SET TITLE = #{TITLE, jdbcType=VARCHAR}
	         , CONTENTS = #{CONTENTS, jdbcType=VARCHAR}
	         , HTML = #{HTML, jdbcType=VARCHAR}
	         , SUBSCRIPTION_YN = #{SUBSCRIPTION_YN, jdbcType=VARCHAR}
	         , STATE = #{STATE, jdbcType=VARCHAR}
	         , SUMMARY = #{SUMMARY, jdbcType=VARCHAR}
	         , SEND_DT = #{SEND_DT, jdbcType=VARCHAR}
	         , NOTICE_YN = #{NOTICE_YN, jdbcType=VARCHAR}
	         , SEND_YN = #{SEND_YN, jdbcType=VARCHAR}
	         , UDT_ID = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = GetDate()
	         , BIGO = #{BIGO, jdbcType=VARCHAR}
	         , CONTENTS_BK = #{CONTENTS_BK, jdbcType=VARCHAR}
	         , LANG = #{LANG, jdbcType=VARCHAR}
	         , REG_IP = #{REG_IP, jdbcType=VARCHAR}
	     WHERE BOARD_CD = #{BOARD_CD}
	       AND BOARD_SEQ = #{BOARD_SEQ}
	</update>
	
	<!-- 게시물 신규 -->
	<insert id="insertBoardDataList" parameterType="map">
	    INSERT INTO TB_BOARD (
	    	BOARD_CD,
	    	REG_NM,
	    	TITLE,
	    	REG_EMAIL,
	    	CONTENTS,
	    	VW_CNT,
	    	PW,
	    	HTML,
	    	REG_IP,
	    	SUBSCRIPTION_YN,
	    	STATE,
	    	SUMMARY,
	    	SEND_DT,
	    	NOTICE_YN,
	    	SEND_YN,
	    	REG_ID,
	    	UDT_ID,
	    	UDT_DT,
	    	REG_DT,
	    	BIGO,
	    	CONTENTS_BK,
	    	LANG
	    )VALUES(
	    	#{BOARD_CD}
	    	,#{session.userId, jdbcType=VARCHAR}
	    	,#{TITLE, jdbcType=VARCHAR}
	    	,#{session.userEmail, jdbcType=VARCHAR}
	    	,#{CONTENTS, jdbcType=VARCHAR}
	    	,0
	    	,#{PW, jdbcType=VARCHAR}
	    	,#{HTML, jdbcType=VARCHAR}
	    	,#{REG_IP, jdbcType=VARCHAR}
	    	,#{SUBSCRIPTION_YN, jdbcType=VARCHAR}
	    	,#{STATE, jdbcType=VARCHAR}
	    	,#{SUMMARY, jdbcType=VARCHAR}
	    	,#{SEND_DT, jdbcType=VARCHAR}
	    	,#{NOTICE_YN, jdbcType=VARCHAR}
	    	,#{SEND_YN, jdbcType=VARCHAR}
	    	,#{session.userId, jdbcType=VARCHAR}
	    	,''
	    	,''
	    	,GetDate()
	    	,#{BIGO, jdbcType=VARCHAR}
	    	,#{CONTENTS_BK, jdbcType=VARCHAR}
	    	,#{LANG, jdbcType=VARCHAR}
	    )
	</insert>
	
	<!-- 수정 -->
	<update id="updateBoardFileDataList" parameterType="map">
	    UPDATE TB_FILE
	       SET FILE_NM = #{FILE_NM, jdbcType=VARCHAR}
	         , SVR_FILE_NM = #{SVR_FILE_NM, jdbcType=VARCHAR}
	         , FILE_SIZE = #{FILE_SIZE, jdbcType=VARCHAR}
	         , UDT_ID = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = getDate()
	     WHERE FILE_SEQ = #{FILE_SEQ}
	       AND TBL_NM = 'TB_BOARD'
	       AND TBL_PK = #{TBL_PK}
	</update>
	
	<!-- 신규 -->
	<insert id="insertBoardFileDataList" parameterType="map">
	    INSERT INTO TB_FILE (
	    	FILE_NM,
	    	SVR_FILE_NM,
	    	FILE_SIZE,
	    	TBL_NM,
	    	TBL_PK,
	    	REG_ID,
	    	UDT_ID,
	    	REG_DT,
	    	UDT_DT,
	    	DOWN_CNT	    	
	    )VALUES(
	    	#{FILE_NM, jdbcType=VARCHAR}
	    	,#{SVR_FILE_NM, jdbcType=VARCHAR}
	    	,#{FILE_SIZE, jdbcType=VARCHAR}
	    	,'TB_BOARD'
	    	,#{TBL_PK, jdbcType=VARCHAR}
	    	,#{session.userId, jdbcType=VARCHAR}
	    	,''
	    	,getDate()
	    	,''
	    	,0
	    )
	</insert>
	
</mapper>