<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="NoticeMapper">
	
	<!-- 게시판을 추가할수 있는 부모 노드 값 조회 -->
	<select id="selectNoticeParentComboList" resultType="map">
	    SELECT ID
			 , TITLE
			 , DESCRIPTION
			 , MENU.BOM_CD.GetLevel() AS BOM_LEVEL
			 , MENU.BOM_CD.ToString() AS BOM_STRING
			 , Roles
			 , URL
			 , PARENT
			 , TP
			 , IDX_MENU
			 , DESIGN_PAGE_ID
			 , BOARD_CD
			 , Hide
		 FROM TB_CONFIG_SITEMAP_20190909 SITEMAP, (SELECT MENU_CD, ORDER_IDX, BOM_CD FROM TB_MENU_20190909) MENU
		WHERE SITEMAP.ID = MENU.MENU_CD
		  AND ID IN (SELECT DISTINCT PARENT
					   FROM TB_CONFIG_SITEMAP_20190909 SITEMAP, (SELECT MENU_CD, ORDER_IDX, BOM_CD FROM TB_MENU_20190909) MENU
					  WHERE SITEMAP.ID = MENU.MENU_CD
						AND TP = 'BOARD')
		ORDER BY ORDER_IDX
	</select>
	
	<select id="selectNoticeList" resultType="map">
	    SELECT BOARD_CD
	    	 , TITLE
	    	 , FILE_UPLOAD
	    	 , COMMENT_REG
	    	 , REG
	    	 , ISNULL(VW_YN, 0) AS VW_YN
	    	 , ISNULL(RSS_YN, 0) AS RSS_YN
	    	 , SUBSCRIPTION
	    	 , DESCRIPTION
	    	 , ISNULL(MAIL_YN, 0) AS MAIL_YN
	    	 , LIST_SIZE
	    	 , REG_ID
	    	 , UDT_ID
	    	 , convert(varchar, REG_DT, 120) AS REG_DT
	    	 , convert(varchar, UDT_DT, 120) AS UDT_DT 
	     FROM TB_BOARD_SETUP
	    WHERE 1=1
	    <if test="title != null and !title.equals('')">
          AND LOWER(TITLE) LIKE LOWER('%' + #{title} + '%')
       	</if>
	</select>
	
	<!-- 삭제 -->
	<delete id="deleteNoticeList" parameterType="map">
	    DELETE FROM TB_BOARD_SETUP
	     WHERE BOARD_CD = #{BOARD_CD}
	</delete>
	
	<!-- 수정 -->
	<update id="updateNoticeList" parameterType="map">
	    UPDATE TB_BOARD_SETUP
	       SET TITLE = #{TITLE}
	         , FILE_UPLOAD = ISNULL(#{FILE_UPLOAD}, 0)
	         , COMMENT_REG = ISNULL(#{COMMENT_REG}, 0)
	         , REG = ISNULL(#{REG}, 0)
	         , VW_YN = ISNULL(#{VW_YN}, 0)
	         , RSS_YN = ISNULL(#{RSS_YN}, 0)
	         , SUBSCRIPTION = #{SUBSCRIPTION}
	         , DESCRIPTION = #{DESCRIPTION}
	         , UDT_ID = #{session.userId, jdbcType=VARCHAR}
	         , UDT_DT = GetDate()
	         , MAIL_YN = ISNULL(#{MAIL_YN}, 0)
	         , LIST_SIZE = ISNULL(#{LIST_SIZE}, 10)
	    WHERE BOARD_CD = #{BOARD_CD}
	</update>
	
	<!-- 신규 -->
	<insert id="insertNoticeList" parameterType="map">
	    INSERT INTO TB_BOARD_SETUP (
	    	BOARD_CD,
	    	TITLE,
	    	FILE_UPLOAD,
	    	COMMENT_REG,
	    	REG,
	    	VW_YN,
	    	RSS_YN,
	    	SUBSCRIPTION,
	    	DESCRIPTION,
	    	REG_ID,
	    	UDT_ID,
	    	UDT_DT,
	    	REG_DT,
	    	MAIL_YN,
	    	LIST_SIZE
	    )VALUES(
	    	#{BOARD_CD}
	    	,#{TITLE}
	    	,ISNULL(#{FILE_UPLOAD}, 0)
	    	,ISNULL(#{COMMENT_REG}, 0)
	    	,ISNULL(#{REG}, 0)
	    	,ISNULL(#{VW_YN}, 0)
	    	,ISNULL(#{RSS_YN}, 0)
	    	,#{SUBSCRIPTION}
	    	,#{DESCRIPTION}
	    	,#{session.userId, jdbcType=VARCHAR}
	    	,''
	    	,''
	    	,GetDate()
	    	,ISNULL(#{MAIL_YN}, 0)
	    	,#{LIST_SIZE}
	    )
	</insert>
	
	<select id="selectHaveIdCnt" resultType="map">
	    SELECT COUNT(*) AS CNT FROM TB_BOARD_SETUP
	     WHERE BOARD_CD = #{boardCd}
	    
	</select>
	
</mapper>